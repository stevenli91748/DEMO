**本文采用kubeadm方式搭建高可用k8s集群，k8s集群的高可用实际是k8s各核心组件的高可用，这里使用主备模式，架构如下**

<a href="https://ibb.co/HDBwm5p"><img src="https://i.ibb.co/3y46tgY/three-master.png" alt="three-master" border="0"></a>


* [一. 部署环境](#一-部署环境)
* [二. 集群模式高可用架构说明](#二-集群模式高可用架构说明)
* [三. 集群环境准备](#三-集群环境准备)
* [高可用免密码登录配置]()

# 一 部署环境

操作系统|	IP|	           角色|	  CPU核心数	|运行内存	|Hostname|
---|---|---|---|---|---|
CentOS 8|	192.168.33.11 |	Master|	2	 |         2G|	   master|
CentOS 8|	192.168.33.12	| Node1 |	  2|	          4G|	    node1|
CentOS 8	| 192.168.33.13	| Node2	|  2	  |        4G	 |   node2|
CentOS 8	| 192.168.33.14	|Node3|	  2	|          4G	|    node3|
CentOS 8	| 192.168.33.15	| NFS	  |  1	 |         1G	  |   nfs|
CentOS 7	| 192.168.33.16 |	Extend |	2	 |          6G	|    extend|
CentOS 8| 192.168.33.10|master2|2|                  2G  |master2|
CentOS 8| 192.168.33.9|master3|2|                   2G  |master3|
CentOS 8| 192.168.33.130|vip|2|                     2G  |vip|
CentOS 8| 192.168.33.131|client|2|                  2G  |client|
CentOS 8| 192.168.33.132|lvs01|2|                  2G  |lvs01|
CentOS 8| 192.168.33.133|lvs02|2|                  2G  |lvs02|
---|---|---|---|---|---|

共有9台服务器，3台control plane，3台work，1台client，2台为lvs-keepalived集群

Docker 版本，kubernetes版本 软件配置如下表所示：

Hostname|操作系统|  IP | Docker|Docker-Compose|kubernetes|Redis|MySQL|Harbor|
---|---|---|---|---|---|---|---|---|
master|centos 8|192.168.33.11|v19.03.13|v1.25.0|v1.19.3|||V1.8.4|
node1|centos 8|192.168.33.12|v19.03.13||v1.19.3||||
node2|centos 8|192.168.33.13|v19.03.13||v1.19.3||||
node3|centos 8|192.168.33.14|v19.03.13||v1.19.3||||
extend|centos 7|192.168.33.16|v19.03.13|v1.25.0||V4.0.14|V5.7.24||
master2|centos 8|192.168.33.10|v19.03.13|v1.25.0|v1.19.3||||
master3|centos 8|192.168.33.9|v19.03.13|v1.25.0|v1.19.3||||
---|---|---|---|---|---|---|


# 二 集群模式高可用架构说明

**k8s集群的高可用实际是k8s各核心组件的高可用，这里使用集群模式(针对apiserver来讲)**

核心组件|	 高可用模式|	    高可用实现方法 |
---|---|---|
Apiserver|集群| lvs + keepalived|
controller-manager|主备| leader election|
scheduler|主备|leader election|
etcd|集群|kubeadm|
---|---|---|

            apiserver 通过lvs-keepalived实现高可用，vip将请求分发至各个control plane节点的apiserver组件；
            controller-manager k8s内部通过选举方式产生领导者(由–leader-elect 选型控制，默认为true)，同一时刻集群内只有一个
                               controller-manager组件运行；
            scheduler k8s内部通过选举方式产生领导者(由–leader-elect 选型控制，默认为true)，同一时刻集群内只有一个scheduler组件运行；
            etcd 通过运行kubeadm方式自动创建集群来实现高可用，部署的节点数为奇数，3节点方式最多容忍一台机器宕机。

# 三 集群环境准备
