
**使用Kubeadm搭建Kubernetes1.16.2集群，宿主机使用9.1里搭建的master、node1、node2、node3四台虚拟机，即一主三从的K8S集群结构**

# 目录

* [1. 安装准备](#1-安装准备)
  * [master虚拟机安装准备](#master虚拟机安装准备)
  * [node1虚拟机安装准备](#node1虚拟机安装准备)
  * [node2虚拟机安装准备](#node2虚拟机安装准备)
  * [node3虚拟机安装准备](#node3虚拟机安装准备)
* [2. 安装kubeadm等工具](#2-安装kubeadm等工具)  
  
---

# 1 安装准备

**在搭建K8S集群之前，我们需要对虚拟机进行一些操作。下面这些操作需要在master、node1、node2、node3四台虚拟机上执行，这里以master为例,但是我会把每一台机的配置步骤都写出来**

## master虚拟机安装准备

    1.安装必要软件：

         yum install -y net-tools.x86_64 wget
    
    2.配置hosts：

        vi /etc/hosts
        内容如下所示：

        192.168.33.11 master
        192.168.33.12 node1
        192.168.33.13 node2
        192.168.33.14 node3

    3.关闭防火墙：

      为了避免kubernetes的Master节点和各个工作节点的Node节点间的通信出现问题，我们可以关闭本地搭建的Centos虚拟机的防火墙。

      systemctl disable firewalld
      systemctl stop firewalld

    4.禁用SELinux，让容器可以顺利地读取主机文件系统：

      setenforce 0

      sed -i 's/^SELINUX=enforcing$/SELINUX=disabled/' /etc/selinux/config
      
    5.修改Docker配置：

        vi /etc/docker/daemon.json
        在{}内追加如下内容：

        "exec-opts": ["native.cgroupdriver=systemd"]

        内容如下：
        
        {
          “registry-mirrors”：[
             "https://dockerhub.azk8s.cn",
             "https://reg-mirror.qiniu.com",
             "https://registry.docker-cn.com"
          ],
          "exec-opts": ["native.cgroupdriver=systemd"]     //新增加的内容
        }

        重启docker：

        systemctl daemon-reload
        systemctl restart docker

      6.将桥接的IPv4流量传递到iptables的链：

         cat > /etc/sysctl.d/k8s.conf << EOF
            net.bridge.bridge-nf-call-ip6tables = 1
            net.bridge.bridge-nf-call-iptables = 1
         EOF

         sysctl --system

      7.关闭swap

          Swap是操作系统在内存吃紧的情况申请的虚拟内存，按照Kubernetes官网的说法，Swap会对Kubernetes的性能造成影响，不推荐使用Swap。

          echo "vm.swappiness = 0">> /etc/sysctl.conf 
          swapoff -a

## node1虚拟机安装准备

## node2虚拟机安装准备

## node3虚拟机安装准备

---

# 2 安装kubeadm等工具
