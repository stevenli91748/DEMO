   **æ­å»ºDockeré•œåƒä»“åº“Harbor** 

åœ¨æœ¬åœ°ç¯å¢ƒä¸‹ï¼ˆæˆ–è€…å…¬å¸å±€åŸŸç½‘ï¼‰ï¼Œå°†Dockeré•œåƒæ¨é€åˆ°Docker Hubé€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œæ¨èçš„åšæ³•æ˜¯å®‰è£…ä¸€ä¸ªç¬¬ä¸‰æ–¹çš„Dockeré•œåƒä»“åº“ï¼Œè¿™é‡Œæ¨èä½¿ç”¨Harborã€‚Harboræ˜¯ä¸€æ¬¾å¼€æºçš„Dockeré•œåƒå­˜å‚¨ä»“åº“ï¼Œå…¶æ‰©å±•äº†Docker Distributionï¼Œåœ¨æ­¤åŸºç¡€ä¸Šæ·»åŠ äº†æˆ‘ä»¬å¸¸ç”¨çš„åŠŸèƒ½ï¼Œæ¯”å¦‚å®‰å…¨è®¤è¯ï¼ŒRBACç”¨æˆ·æƒé™ç®¡ç†ï¼Œå¯è§†åŒ–é¡µé¢æ“ä½œç­‰åŠŸèƒ½ã€‚

# ç›®å½•
  * [1. å®‰è£…Harbor](#1-å®‰è£…Harbor)
  * [2. åˆ›å»ºç”¨æˆ·å’Œé¡¹ç›®](#2-åˆ›å»ºç”¨æˆ·å’Œé¡¹ç›®)
  * [3. æµ‹è¯•é•œåƒæ¨æ‹‰](#3-æµ‹è¯•é•œåƒæ¨æ‹‰)
  * [4. å¼€å¯è¿œç¨‹Docker](#4-å¼€å¯è¿œç¨‹Docker)
  * [5. æ„å»ºFEBSä¸šåŠ¡å¾®æœåŠ¡Dockeré•œåƒ](#5-æ„å»ºFEBSä¸šåŠ¡æœåŠ¡Dockeré•œåƒ)
    * [5A æ„å»ºfebs-authä¸šåŠ¡å¾®æœåŠ¡æ¨¡å—å¯¹åº”çš„Dockeré•œåƒ](#5A-æ„å»ºfebs-authä¸šåŠ¡å¾®æœåŠ¡æ¨¡å—å¯¹åº”çš„Dockeré•œåƒ)
    * [5B æ„å»ºfebs-gatewayä¸šåŠ¡å¾®æœåŠ¡æ¨¡å—å¯¹åº”çš„Dockeré•œåƒ](#5B-æ„å»ºfebs-gatewayä¸šåŠ¡å¾®æœåŠ¡æ¨¡å—å¯¹åº”çš„Dockeré•œåƒ)
    * [5C æ„å»ºfebs-monitor-adminä¸šåŠ¡å¾®æœåŠ¡æ¨¡å—å¯¹åº”çš„Dockeré•œåƒ](#5C-æ„å»ºfebs-monitor-adminä¸šåŠ¡å¾®æœåŠ¡æ¨¡å—å¯¹åº”çš„Dockeré•œåƒ)
    * [5D æ„å»ºfebs-server-systemä¸šåŠ¡å¾®æœåŠ¡æ¨¡å—å¯¹åº”çš„Dockeré•œåƒ](#5D-æ„å»ºfebs-server-systemä¸šåŠ¡å¾®æœåŠ¡æ¨¡å—å¯¹åº”çš„Dockeré•œåƒ)
    * [5F æ„å»ºfebs-server-testä¸šåŠ¡å¾®æœåŠ¡æ¨¡å—å¯¹åº”çš„Dockeré•œåƒ](#5F-æ„å»ºfebs-server-testä¸šåŠ¡å¾®æœåŠ¡æ¨¡å—å¯¹åº”çš„Dockeré•œåƒ)



# 1 å®‰è£…Harbor

ç™»å½•masterè™šæ‹Ÿæœºï¼Œåœ¨/home/vagrantç›®å½•ä¸‹æ–°å»ºå¹¶åˆ‡æ¢åˆ°harborç›®å½•ï¼š

    [root/master]# mkdir /home/vagrant/harbor
    [root/master]# cd /home/vagrant/harbor

ä¸‹è½½Harborç¦»çº¿å®‰è£…åŒ…ï¼š

    [root/master]# wget https://storage.googleapis.com/harbor-releases/release-1.8.0/harbor-offline-installer-v1.8.4.tgz

ä¸‹è½½åè§£å‹ï¼š

    [root/master harbor]# tar -xzvf harbor-offline-installer-v1.8.4.tgz

ä¿®æ”¹Harboré…ç½®æ–‡ä»¶ï¼š

    [root/master harbor]# vi harbor/harbor.yml

å°†hostnameä¿®æ”¹ä¸ºå®¿ä¸»æœºIPå³å¯ï¼š

    hostname 192.168.33.11

<a href="https://ibb.co/B4PNsPJ"><img src="https://i.ibb.co/4sfdNfL/harbor1.png" alt="harbor1" border="0"></a>

ä¸ºäº†åç»­æ¨é€é•œåƒæ–¹ä¾¿ï¼Œæˆ‘ä»¬éœ€è¦ç»™**Harboråœ°å€é…ç½®åŸŸå: docker.mrbird.cc**

æ·»åŠ å¦‚ä¸‹å†…å®¹åˆ°daemon.jsonæ–‡ä»¶ä¸Šï¼š

   "insecure-registries": ["docker.mrbird.cc"] 
   
     [root/master harbor]# vi /etc/docker/daemon.json    
   
<a href="https://ibb.co/4TwMHxK"><img src="https://i.ibb.co/hWxHSvL/harbor2.png" alt="harbor2" border="0"></a>   

é‡å¯dockerï¼š

    [root/master harbor]# systemctl restart docker
   
ç„¶åæ‰§è¡Œå½“å‰ç›®å½•ä¸‹çš„install.shè„šæœ¬è¿›è¡Œå®‰è£…ï¼š

    [root/master harbor]#  sh harbor/install.sh
   
<a href="https://ibb.co/0s0tFsW"><img src="https://i.ibb.co/1zC6dzp/harbor3.png" alt="harbor3" border="0"></a>   
   
å› ä¸ºåç»­éœ€è¦åœ¨masterè™šæ‹Ÿæœºä¸Špush Dockeré•œåƒï¼Œå¹¶ä¸”éœ€è¦åœ¨node1ã€node2ã€node3å’Œextendè™šæ‹Ÿæœºä¸‹pull Dockeré•œåƒï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨master node1 node2 node3 extendè™šæ‹Ÿæœºä¸‹æ·»åŠ hostsè§£æå’Œé…ç½®é…ç½®åŸŸå: docker.mrbird.cc

---

**åœ¨master ä¸Šï¼š**

     [root/master harbor]# vi /etc/hosts
     æ·»åŠ å¦‚ä¸‹è§£æï¼š

     192.168.33.11 docker.mrbird.cc

---

**åœ¨Node1 ä¸Šï¼š**

     [root/Node1 ]# vi /etc/hosts
     æ·»åŠ å¦‚ä¸‹è§£æï¼š

     192.168.33.11 docker.mrbird.cc

ä¸ºäº†åç»­æ¨é€é•œåƒæ–¹ä¾¿ï¼Œæˆ‘ä»¬éœ€è¦åœ¨Node1ä¸Šç»™**Harboråœ°å€é…ç½®åŸŸå: docker.mrbird.cc**

æ·»åŠ å¦‚ä¸‹å†…å®¹åˆ°daemon.jsonæ–‡ä»¶ä¸Šï¼š

    "insecure-registries": ["docker.mrbird.cc"] 
   
     [root/Node1 harbor]# vi /etc/docker/daemon.json    
   
<a href="https://ibb.co/4TwMHxK"><img src="https://i.ibb.co/hWxHSvL/harbor2.png" alt="harbor2" border="0"></a>   

é‡å¯dockerï¼š

    [root/Node1 harbor]# systemctl daemon-reload
    [root/Node1 harbor]# systemctl restart docker

---

**åœ¨Node2 ä¸Šï¼š**

     [root/Node2 ]# vi /etc/hosts
     æ·»åŠ å¦‚ä¸‹è§£æï¼š

     192.168.33.11 docker.mrbird.cc

ä¸ºäº†åç»­æ¨é€é•œåƒæ–¹ä¾¿ï¼Œæˆ‘ä»¬éœ€è¦åœ¨Node2ä¸Šç»™**Harboråœ°å€é…ç½®åŸŸå: docker.mrbird.cc**

æ·»åŠ å¦‚ä¸‹å†…å®¹åˆ°daemon.jsonæ–‡ä»¶ä¸Šï¼š

    "insecure-registries": ["docker.mrbird.cc"] 
   
     [root/Node2 harbor]# vi /etc/docker/daemon.json    
   
<a href="https://ibb.co/4TwMHxK"><img src="https://i.ibb.co/hWxHSvL/harbor2.png" alt="harbor2" border="0"></a>   

é‡å¯dockerï¼š

    [root/Node2 harbor]# systemctl daemon-reload
    [root/Node2 harbor]# systemctl restart docker

---

**åœ¨Node3 ä¸Šï¼š**

     [root/Node3 ]# vi /etc/hosts
     æ·»åŠ å¦‚ä¸‹è§£æï¼š

     192.168.33.11 docker.mrbird.cc

ä¸ºäº†åç»­æ¨é€é•œåƒæ–¹ä¾¿ï¼Œæˆ‘ä»¬éœ€è¦åœ¨Node3ä¸Šç»™**Harboråœ°å€é…ç½®åŸŸå: docker.mrbird.cc**

æ·»åŠ å¦‚ä¸‹å†…å®¹åˆ°daemon.jsonæ–‡ä»¶ä¸Šï¼š

    "insecure-registries": ["docker.mrbird.cc"] 
   
     [root/Node3 harbor]# vi /etc/docker/daemon.json    
   
<a href="https://ibb.co/4TwMHxK"><img src="https://i.ibb.co/hWxHSvL/harbor2.png" alt="harbor2" border="0"></a>   

é‡å¯dockerï¼š
    
    [root/Node3 harbor]# systemctl daemon-reload
    [root/Node3 harbor]# systemctl restart docker


---

**åœ¨Extend ä¸Šï¼š**

     [root/Extend ]# vi /etc/hosts
     æ·»åŠ å¦‚ä¸‹è§£æï¼š

     192.168.33.11 docker.mrbird.cc

ä¸ºäº†åç»­æ¨é€é•œåƒæ–¹ä¾¿ï¼Œæˆ‘ä»¬éœ€è¦åœ¨Extendä¸Šç»™**Harboråœ°å€é…ç½®åŸŸå: docker.mrbird.cc**

æ·»åŠ å¦‚ä¸‹å†…å®¹åˆ°daemon.jsonæ–‡ä»¶ä¸Šï¼š

    "insecure-registries": ["docker.mrbird.cc"] 
   
     [root/Extend harbor]# vi /etc/docker/daemon.json    
   
<a href="https://ibb.co/4TwMHxK"><img src="https://i.ibb.co/hWxHSvL/harbor2.png" alt="harbor2" border="0"></a>   

é‡å¯dockerï¼š

    [root/Extend harbor]# systemctl daemon-reload
    [root/Extend harbor]# systemctl restart docker



---

åœ¨Windowsä¸Šä½¿ç”¨æµè§ˆå™¨è®¿é—®ï¼šhttp://192.168.33.11/

<a href="https://ibb.co/MGG4dm7"><img src="https://i.ibb.co/dLLqZRD/harbor4.png" alt="harbor4" border="0"></a>

**é»˜è®¤çš„ç”¨æˆ·åå¯†ç ï¼šç”¨æˆ·åä¸º adminï¼Œå¯†ç ä¸ºHarbor12345**ï¼Œç™»å½•åï¼š

<a href="https://ibb.co/71Cgymz"><img src="https://i.ibb.co/DRWGK2b/harbor5.png" alt="harbor5" border="0"></a>


# 2 åˆ›å»ºç”¨æˆ·å’Œé¡¹ç›®

åœ¨http://192.168.33.11/Harborç®¡ç†ç•Œé¢ä¸‹æ–°å¢ä¸€ä¸ªç”¨æˆ·ï¼š

<a href="https://ibb.co/KhKK2HP"><img src="https://i.ibb.co/c3YY6dB/harbor6.png" alt="harbor6" border="0"></a>

<a href="https://ibb.co/ct3dBD9"><img src="https://i.ibb.co/Gkpj6cD/harbor7.png" alt="harbor7" border="0"></a>

**ç”¨æˆ·åä¸ºmrbirdï¼Œå¯†ç ä¸ºAa112233**

ç„¶åæ–°å¢ä¸€ä¸ªé¡¹ç›®ï¼š

<a href="https://ibb.co/yR5txb9"><img src="https://i.ibb.co/VNDRkP1/harbor8.png" alt="harbor8" border="0"></a>

<a href="https://ibb.co/HHfwzM0"><img src="https://i.ibb.co/bKMwByx/harbor9.png" alt="harbor9" border="0"></a>

åœ¨è¯¥é¡¹ç›®ä¸‹æ·»åŠ åˆšåˆšåˆ›å»ºçš„mrbirdç”¨æˆ·ï¼š

<a href="https://ibb.co/9c8dddT"><img src="https://i.ibb.co/NtVGGGj/harbor10.png" alt="harbor10" border="0"></a>

<a href="https://ibb.co/njD9Dt6"><img src="https://i.ibb.co/bXrTrDQ/harbor11.png" alt="harbor11" border="0"></a>

æ¥ç€åœ¨masterè™šæ‹Ÿæœºä¸Šç™»å½•Harborï¼Œç”¨æˆ·åå’Œå¯†ç å°±æ˜¯åˆšåˆšåœ¨æ§åˆ¶å°åˆ›å»ºçš„mrbirdç”¨æˆ·å’Œå¯†ç :

<a href="https://ibb.co/m8XNFz6"><img src="https://i.ibb.co/3zMRYhB/harbor13.png" alt="harbor13" border="0"></a>

# 3 æµ‹è¯•é•œåƒæ¨æ‹‰

æ¥ç€æµ‹è¯•ä¸‹ï¼Œæ˜¯å¦èƒ½å¤Ÿé¡ºåˆ©çš„å°†Dockeré•œåƒæ¨é€åˆ°Harborä»“åº“ä¸­ã€‚

åœ¨masterä¸­ä»å®˜æ–¹Docker Hubä¸­æ‹‰å–busyboxé•œåƒ

    [root/master harbor]# docker pull busybox

ç„¶åç»™è¯¥é•œåƒæ‰“æ ‡ç­¾:

     [root/master harbor]# docker tag busybox:latest docker.mrbird.cc/febs/busybox:latest
     
æ ‡ç­¾æ ¼å¼ä¸º[dockerä»“åº“åŸŸå]/[é¡¹ç›®åç§°]/[é•œåƒ:ç‰ˆæœ¬]ã€‚

æ‰“å¥½æ ‡ç­¾åï¼Œå°† docker.mrbird.cc/febs/busybox:latest é•œåƒæ¨é€åˆ°Harborä»“åº“ï¼š

    [root/master harbor]# docker push docker.mrbird.cc/febs/busybox:latest
    
<a href="https://ibb.co/yYddtvS"><img src="https://i.ibb.co/nn669dC/harbor14.png" alt="harbor14" border="0"></a>

å›åˆ°Harboræ§åˆ¶å°ï¼Œå¯ä»¥çœ‹åˆ°åœ¨febsé¡¹ç›®ä¸‹å·²ç»å­˜åœ¨ä¸€ä¸ªbusyboxé•œåƒï¼š

<a href="https://ibb.co/R0Hs3Mp"><img src="https://i.ibb.co/jM4Qyxv/harbor15.png" alt="harbor15" border="0"></a>

ç°åœ¨Harborä»“åº“ä¸­å·²ç»å­˜åœ¨busyboxé•œåƒäº†ï¼Œæ¥ç€æµ‹è¯•ä¸‹æ˜¯å¦å¯ä»¥åœ¨åˆ«çš„è™šæ‹Ÿæœºä¸Šæ‹‰å–ä¸‹æ¥ã€‚æˆ‘ä»¬éšä¾¿æŒ‘ä¸€å°é…ç½®äº†docker.mrbird.ccåŸŸåè§£æçš„è™šæ‹Ÿæœºè¿›è¡Œæµ‹è¯•ï¼Œæ¯”å¦‚extendï¼Œåœ¨extendè™šæ‹Ÿæœºä¸Šæ‹‰å– docker.mrbird.cc/febs/busybox:latest é•œåƒï¼š

     [root/extend ]# docker images |grep busy
     nothing show in screen

     [root/extend ]# docker pull docker.mrbird.cc/febs/busybox:latest
     [root/extend ]# docker images | grep busy
     busybox image......................
     <a href="https://ibb.co/BZTtVdX"><img src="https://i.ibb.co/58s6WtN/harbor16.png" alt="harbor16" border="0"></a>     

# 4 å¼€å¯è¿œç¨‹Docker

åç»­æˆ‘ä»¬éœ€è¦åœ¨Windowsä¸Šï¼Œé€šè¿‡IDEAçš„Dockeræ’ä»¶è¿œç¨‹æ„å»ºé•œåƒã€‚çº¦å®šçš„åšæ³•æ˜¯ï¼Œé€šè¿‡IDEA Dockeræ’ä»¶åœ¨masterè™šæ‹Ÿæœºä¸Šè¿œç¨‹æ„å»ºDockeré•œåƒï¼Œå†å°†è¿™äº›é•œåƒæ¨é€åˆ°Harborä»“åº“ã€‚

è¦å¼€å¯masterè™šæ‹ŸæœºDockeræœåŠ¡è¿œç¨‹è®¿é—®ï¼Œéœ€è¦ä¿®æ”¹masterè™šæ‹Ÿæœºä¸Šçš„Dockeré…ç½®ï¼š

     [root/master harbor]# vi /lib/systemd/system/docker.service
     
     ä¿®æ”¹çš„åœ°æ–¹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
     
<a href="https://ibb.co/dj3DqvR"><img src="https://i.ibb.co/WGdfwXL/harbor17.png" alt="harbor17" border="0"></a>     

ä¿®æ”¹ä¿å­˜åï¼Œé‡å¯DockeræœåŠ¡ï¼š

      [root/master harbor]# systemctl daemon-reload 
      [root/master harbor]# systemctl restart docker.service
      
é‡å¯åï¼ŒéªŒè¯ä¸‹2375ç«¯å£æ˜¯å¦æ˜¯é€šçš„ï¼š

      [root/master harbor]# curl 192.168.33.11:2375/info
      
      å¦‚æœè¿”å›äº†ä¸€å¨JSONæ•°æ®ï¼Œè¯´æ˜ğŸ†—ã€‚


# 5 æ„å»ºFEBSä¸šåŠ¡æœåŠ¡Dockeré•œåƒ

æ¥ç€æˆ‘ä»¬éœ€è¦åœ¨IDEAä¸Šé…ç½®è¿œç¨‹DockeræœåŠ¡ï¼Œå¹¶æ„å»ºfebs-authã€febs-gatewayã€febs-monitor-adminã€febs-server-systemå’Œfebs-server-testå¾®æœåŠ¡æ¨¡å—å¯¹åº”çš„Dockeré•œåƒã€‚

IDEA Ultimateç‰ˆæœ¬å·²ç»é»˜è®¤å®‰è£…äº†Dockeræ’ä»¶ï¼ˆæ²¡æœ‰çš„è¯å»æ’ä»¶å¸‚åœºä¸‹è½½å®‰è£…ä¸‹å°±å¯ä»¥äº†ï¼‰ã€‚ç‚¹å‡»IDEA -> File -> Settingsâ€¦ -> Build,Execution,Deployment -> Dockerï¼š

<a href="https://ibb.co/HgN3vdp"><img src="https://i.ibb.co/f08LRvG/harbor18.png" alt="harbor18" border="0"></a>

å¡«å†™è¿œç¨‹Dockeråœ°å€(masterè™šæ‹Ÿæœºåœ°å€:  192.168.33.11 )ï¼Œå¦‚æœæ˜¾ç¤ºConnection Successfullyè¯´æ˜è¿æ¥è¿œç¨‹DockeræœåŠ¡æˆåŠŸã€‚

**è¿™ä¸ª master docker serveræ˜¯è¡¨ç¤ºæŒ‡å®šè¿æ¥è¿œç¨‹masterè™šæ‹Ÿæœº(192.168.33.11)ï¼Œå¯ä»¥åœ¨è¿™æ­¥ç”ŸæˆæŒ‡å‘ä¸åŒIPåœ°å€çš„è¿œç¨‹DockeræœåŠ¡**

# 5A æ„å»ºfebs-authä¸šåŠ¡å¾®æœåŠ¡æ¨¡å—å¯¹åº”çš„Dockeré•œåƒ

# 5B æ„å»ºfebs-gatewayä¸šåŠ¡å¾®æœåŠ¡æ¨¡å—å¯¹åº”çš„Dockeré•œåƒ

# 5C æ„å»ºfebs-monitor-adminä¸šåŠ¡å¾®æœåŠ¡æ¨¡å—å¯¹åº”çš„Dockeré•œåƒ

# 5D æ„å»ºfebs-server-systemä¸šåŠ¡å¾®æœåŠ¡æ¨¡å—å¯¹åº”çš„Dockeré•œåƒ

# 5F æ„å»ºfebs-server-testä¸šåŠ¡å¾®æœåŠ¡æ¨¡å—å¯¹åº”çš„Dockeré•œåƒ
